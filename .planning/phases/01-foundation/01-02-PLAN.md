---
phase: 01-foundation
plan: 02
type: execute
---

<objective>
Secure Django settings by moving secrets to environment variables.

Purpose: Remove hardcoded secrets from settings.py, enable environment-based configuration.
Output: settings.py reads from environment, .env file with local credentials created.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@JokesForProject/settings.py

**Prior plan (01-01) delivered:**
- .gitignore (protects .env from being committed)
- requirements.txt with python-dotenv installed
- .env.example template

**Security concerns being addressed:**
- Hardcoded SECRET_KEY at settings.py line 23
- Hardcoded DEBUG=True at settings.py line 26
- Empty ALLOWED_HOSTS at settings.py line 28

**Local PostgreSQL credentials (from PROJECT.md):**
- Host: localhost:5432
- User: postgres
- Password: 6969
- Database: jokesfor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update settings.py to use environment variables</name>
  <files>JokesForProject/settings.py</files>
  <action>
Modify settings.py to load from environment:

1. Add imports at top (after `from pathlib import Path`):
```python
import os
from dotenv import load_dotenv

load_dotenv()
```

2. Replace SECRET_KEY (line 23):
```python
SECRET_KEY = os.getenv('SECRET_KEY', 'django-insecure-dev-only-key')
```

3. Replace DEBUG (line 26):
```python
DEBUG = os.getenv('DEBUG', 'False').lower() in ('true', '1', 'yes')
```

4. Replace ALLOWED_HOSTS (line 28):
```python
ALLOWED_HOSTS = [h.strip() for h in os.getenv('ALLOWED_HOSTS', 'localhost,127.0.0.1').split(',') if h.strip()]
```

Keep all other settings unchanged. The dotenv load_dotenv() call automatically reads .env file if present.
  </action>
  <verify>grep -E "SECRET_KEY|DEBUG|ALLOWED_HOSTS|load_dotenv" JokesForProject/settings.py</verify>
  <done>settings.py reads SECRET_KEY, DEBUG, ALLOWED_HOSTS from environment with sensible defaults</done>
</task>

<task type="auto">
  <name>Task 2: Generate secure SECRET_KEY and create .env</name>
  <files>.env</files>
  <action>
1. Generate a new secure SECRET_KEY using Python:
```python
from django.core.management.utils import get_random_secret_key
print(get_random_secret_key())
```

2. Create .env file with:
```
# Django settings
SECRET_KEY=<generated-key>
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Database (PostgreSQL) - local development
DB_NAME=jokesfor
DB_USER=postgres
DB_PASSWORD=6969
DB_HOST=localhost
DB_PORT=5432
```

The .env file will NOT be committed (protected by .gitignore from Plan 01).
  </action>
  <verify>test -f .env && grep -c "SECRET_KEY" .env && ! git check-ignore .env > /dev/null 2>&1 || echo ".env is gitignored"</verify>
  <done>.env exists with secure SECRET_KEY and local database credentials, file is gitignored</done>
</task>

<task type="auto">
  <name>Task 3: Verify Django loads configuration correctly</name>
  <files>-</files>
  <action>
Verify the configuration works by running Django's check command:

1. Run: python manage.py check
   - Should complete without errors
   - Confirms settings.py parses correctly

2. Run: python manage.py shell -c "from django.conf import settings; print(f'DEBUG={settings.DEBUG}, ALLOWED_HOSTS={settings.ALLOWED_HOSTS}')"
   - Should show DEBUG=True and ALLOWED_HOSTS=['localhost', '127.0.0.1']
   - Confirms environment variables are being read

If errors occur, check:
- .env file exists in project root
- python-dotenv is installed
- load_dotenv() is called before os.getenv() in settings.py
  </action>
  <verify>python manage.py check && python manage.py shell -c "from django.conf import settings; print(f'DEBUG={settings.DEBUG}')"</verify>
  <done>Django check passes, environment variables load correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] settings.py imports os and dotenv, calls load_dotenv()
- [ ] SECRET_KEY reads from os.getenv() with fallback
- [ ] DEBUG reads from os.getenv() with proper boolean conversion
- [ ] ALLOWED_HOSTS reads from os.getenv() and splits on comma
- [ ] .env file exists with secure SECRET_KEY and DB credentials
- [ ] .env is not tracked by git (verify: git status shows no .env)
- [ ] `python manage.py check` passes without errors
</verification>

<success_criteria>
- All 3 tasks completed
- All verification checks pass
- No secrets in version control
- Django runs with environment-based configuration
- Ready for PostgreSQL configuration (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
