---
phase: 01-foundation
plan: 03
type: execute
---

<objective>
Configure PostgreSQL database connection and verify setup.

Purpose: Switch from SQLite to PostgreSQL for production-ready database with full-text search capability.
Output: Django connected to local PostgreSQL database, migrations applied successfully.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@JokesForProject/settings.py

**Prior plans delivered:**
- Plan 01-01: .gitignore, requirements.txt, .env.example
- Plan 01-02: Environment-based settings, .env with DB credentials

**Local PostgreSQL configuration (from PROJECT.md):**
- Host: localhost
- Port: 5432
- User: postgres
- Password: 6969
- Database: jokesfor (to be created)

**Why PostgreSQL:**
- Full-text search support (required for Phase 04)
- Production-ready (SQLite can't handle concurrent writes)
- Already installed locally on user's machine
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PostgreSQL database</name>
  <files>-</files>
  <action>
Create the `jokesfor` database using psql or createdb:

Option A (createdb):
```bash
PGPASSWORD=6969 createdb -h localhost -U postgres jokesfor
```

Option B (psql):
```bash
PGPASSWORD=6969 psql -h localhost -U postgres -c "CREATE DATABASE jokesfor;"
```

If database already exists, this is fine - we'll verify connection in Task 3.

Do NOT create any tables - Django migrations will handle that.
  </action>
  <verify>PGPASSWORD=6969 psql -h localhost -U postgres -c "\l" | grep jokesfor</verify>
  <done>Database `jokesfor` exists in PostgreSQL</done>
</task>

<task type="auto">
  <name>Task 2: Update settings.py DATABASES configuration</name>
  <files>JokesForProject/settings.py</files>
  <action>
Replace the DATABASES configuration (currently SQLite at lines 76-81) with PostgreSQL:

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': os.getenv('DB_NAME', 'jokesfor'),
        'USER': os.getenv('DB_USER', 'postgres'),
        'PASSWORD': os.getenv('DB_PASSWORD', ''),
        'HOST': os.getenv('DB_HOST', 'localhost'),
        'PORT': os.getenv('DB_PORT', '5432'),
    }
}
```

This reads all database settings from environment variables (already in .env from Plan 02).
The defaults are set for local development convenience.

Keep the comment above DATABASES intact.
  </action>
  <verify>grep -A 10 "DATABASES = {" JokesForProject/settings.py</verify>
  <done>DATABASES configuration uses PostgreSQL with environment variables</done>
</task>

<task type="auto">
  <name>Task 3: Run Django migrations and verify connection</name>
  <files>-</files>
  <action>
Apply Django's built-in migrations to verify database connection:

1. Run: python manage.py migrate
   - Creates Django's default tables (auth, sessions, admin, etc.)
   - Verifies database connection works
   - Verifies psycopg2 adapter works

2. Run: python manage.py dbshell -c "\dt"
   - Lists tables in database
   - Should show auth_*, django_*, etc.

If connection fails, check:
- PostgreSQL is running: pg_isready -h localhost -p 5432
- Credentials in .env match what was used to create database
- Database jokesfor exists
- psycopg2-binary is installed (from Plan 01)
  </action>
  <verify>python manage.py migrate --check && python manage.py shell -c "from django.db import connection; cursor = connection.cursor(); print('DB connection OK')"</verify>
  <done>Django migrations applied, PostgreSQL connection verified</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Database `jokesfor` exists in PostgreSQL
- [ ] settings.py DATABASES uses 'django.db.backends.postgresql'
- [ ] All DB settings read from environment variables
- [ ] `python manage.py migrate` completes successfully
- [ ] `python manage.py check --database default` passes
- [ ] Django can connect and query the database
</verification>

<success_criteria>
- All 3 tasks completed
- All verification checks pass
- Django connected to PostgreSQL (not SQLite)
- Default Django migrations applied (auth, sessions, admin)
- Foundation phase complete - ready for Phase 02: Data Models
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` with:

# Phase 01 Plan 03: PostgreSQL Setup Summary

**[One-liner summary]**

## Accomplishments
- Created jokesfor database in PostgreSQL
- Configured Django to use PostgreSQL via environment variables
- Applied initial migrations

## Files Created/Modified
- JokesForProject/settings.py - DATABASES configuration

## Decisions Made
- [Any decisions about database setup]

## Issues Encountered
- [Any connection issues, or "None"]

## Next Phase Readiness
Phase 01: Foundation is COMPLETE.
Ready for Phase 02: Data Models (Joke model with metadata).
</output>
