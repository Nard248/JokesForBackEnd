---
phase: 03-content-seeding
plan: 01
type: execute
---

<objective>
Populate database with lookup data and 100-200 curated jokes for development testing.

Purpose: Enable development/testing of search, filtering, and all downstream features with realistic data diversity.
Output: Seeded database with complete lookup tables and 100+ jokes covering all categories.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-models/02-01-SUMMARY.md

# Key files from Phase 02:
@jokes/models.py
@jokes/admin.py

**Tech stack available:** Django 5.x, PostgreSQL, existing jokes app with 8 models

**Established patterns:**
- Lookup tables with name/slug/description pattern
- M2M for multi-value attributes (tones, context_tags, culture_tags)
- FK for single-value attributes (format, age_rating, language)

**Constraining decisions:**
- Phase 02: Used PROTECT on_delete for required FKs
- Phase 02: Slugs on all lookup tables for URL-friendly filtering

**Required diversity per PROJECT.md:**
- All humor types (tones): clean, dark, dad-jokes, puns, sarcasm
- All age ratings: kid-safe, teen, adult, family-friendly
- Multiple contexts: wedding, work, school, presentation, icebreaker
- Various formats: one-liner, setup-punchline, short-story
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create and load lookup table fixtures</name>
  <files>jokes/fixtures/lookup_data.json</files>
  <action>
Create JSON fixture with initial data for all lookup tables:

**Format** (3 records):
- One-liner (slug: one-liner) - Single sentence jokes
- Setup-Punchline (slug: setup-punchline) - Two-part jokes with setup and delivery
- Short Story (slug: short-story) - Multi-sentence narrative jokes

**AgeRating** (4 records):
- Kid-Safe (slug: kid-safe, min_age: 0) - Appropriate for all ages
- Family-Friendly (slug: family-friendly, min_age: 8) - Safe for family settings
- Teen (slug: teen, min_age: 13) - May contain mild themes
- Adult (slug: adult, min_age: 18) - Mature themes only

**Tone** (5 records):
- Clean (slug: clean) - Wholesome, inoffensive humor
- Dark (slug: dark) - Morbid or edgy humor
- Dad Jokes (slug: dad-jokes) - Cheesy, pun-based, groan-worthy
- Puns (slug: puns) - Wordplay-based humor
- Sarcasm (slug: sarcasm) - Ironic, dry wit

**ContextTag** (8 records):
- Wedding (slug: wedding)
- Work (slug: work)
- School (slug: school)
- Presentation (slug: presentation)
- Icebreaker (slug: icebreaker)
- Party (slug: party)
- Dinner (slug: dinner)
- Social Media (slug: social-media)

**Language** (1 record for MVP):
- English (code: en)

**CultureTag** (3 records):
- Universal (slug: universal) - Works across cultures
- American (slug: american) - US-specific references
- British (slug: british) - UK-specific references

**Source** (3 records):
- Public Domain (url: blank) - Classic jokes
- AI Generated (url: blank) - Claude-generated jokes
- User Submitted (url: blank) - Placeholder for future

Use Django fixture format with model, pk, and fields.
Load fixture with `python manage.py loaddata lookup_data`.
  </action>
  <verify>python manage.py loaddata lookup_data succeeds, then verify counts: Format=3, AgeRating=4, Tone=5, ContextTag=8, Language=1, CultureTag=3, Source=3</verify>
  <done>All lookup tables populated, fixture loads without errors, admin shows all records</done>
</task>

<task type="auto">
  <name>Task 2: Create management command for joke seeding</name>
  <files>jokes/management/commands/seed_jokes.py, jokes/management/__init__.py, jokes/management/commands/__init__.py</files>
  <action>
Create Django management command `seed_jokes` that:

1. Creates management directory structure (jokes/management/commands/ with __init__.py files)

2. Implements command class inheriting from BaseCommand:
   - add_arguments: --count (default 150), --clear (flag to delete existing jokes first)
   - handle: Load jokes from fixture file, validate required lookup data exists
   - Use transaction.atomic() for bulk operations

3. Command should:
   - Check lookup tables are populated (error if empty)
   - Load jokes from jokes/fixtures/jokes.json
   - Report count of jokes loaded
   - Use bulk_create for efficiency (but handle M2M separately since bulk_create doesn't support M2M)

4. For M2M fields (tones, context_tags, culture_tags):
   - Create Joke objects first
   - Then set M2M relationships using .set() or .add()

Output: "Successfully loaded X jokes" or clear error message if lookup data missing.
  </action>
  <verify>python manage.py seed_jokes --help shows usage; command with empty jokes fixture reports "0 jokes loaded" without error</verify>
  <done>Management command exists, runs without error, correctly checks for lookup data, handles M2M relationships</done>
</task>

<task type="auto">
  <name>Task 3: Create jokes fixture with 100+ curated jokes</name>
  <files>jokes/fixtures/jokes.json</files>
  <action>
Create JSON fixture with 100-150 jokes ensuring diverse coverage.

**Distribution targets:**
- Format: ~50% one-liner, ~35% setup-punchline, ~15% short-story
- AgeRating: ~40% family-friendly, ~30% kid-safe, ~20% teen, ~10% adult
- Tones: Even distribution across all 5 types, with many jokes having multiple tones
- Contexts: Every context tag used on 10+ jokes, with overlap

**Structure per joke:**
```json
{
  "model": "jokes.joke",
  "pk": 1,
  "fields": {
    "text": "Full joke text here",
    "setup": "",
    "punchline": "",
    "format": 1,
    "age_rating": 1,
    "language": 1,
    "source": 1,
    "tones": [1, 3],
    "context_tags": [1, 5],
    "culture_tags": [1]
  }
}
```

**Content guidelines:**
- For setup-punchline format: populate setup and punchline fields, text can be combined version
- For one-liner: text only, setup/punchline blank
- For short-story: text contains full narrative
- Use foreign key PKs matching lookup_data.json
- Reference tones/contexts/cultures by PK arrays

**Generate mix of:**
- Classic public domain jokes (dad jokes, puns)
- Work-appropriate humor (meetings, presentations)
- Kid-friendly jokes (school, family)
- Wedding/event appropriate humor
- General icebreakers

After creating fixture, run seed_jokes command to verify it loads.
  </action>
  <verify>python manage.py seed_jokes loads 100+ jokes; Joke.objects.count() returns 100+; admin shows jokes with proper FK/M2M relationships</verify>
  <done>100+ jokes in database with diverse coverage across all lookup categories, all relationships valid</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `python manage.py loaddata lookup_data` succeeds
- [ ] `python manage.py seed_jokes` loads 100+ jokes
- [ ] All lookup tables have expected record counts
- [ ] Jokes visible in Django admin with filters working
- [ ] Random sample of jokes have correct format, age_rating, tones, context_tags
- [ ] No orphaned relationships or integrity errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Database contains 100+ jokes with full metadata
- Lookup tables fully populated
- Data supports Phase 04 (Search Engine) development
- Reproducible via fixtures (can reset and reseed)
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-seeding/03-01-SUMMARY.md`:

# Phase 03 Plan 01: Content Seeding Summary

**[Substantive one-liner about what was delivered]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]
- [Key outcome 3]

## Files Created/Modified

- `jokes/fixtures/lookup_data.json` - Lookup table data
- `jokes/fixtures/jokes.json` - 100+ curated jokes
- `jokes/management/commands/seed_jokes.py` - Seeding command

## Data Statistics

| Model | Count |
|-------|-------|
| Joke | X |
| Format | 3 |
| AgeRating | 4 |
| Tone | 5 |
| ContextTag | 8 |
| Language | 1 |
| CultureTag | 3 |
| Source | 3 |

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

- Database ready for full-text search implementation (Phase 04)
- Sufficient data volume for testing search relevance
- All filter categories populated for filter testing
</output>
