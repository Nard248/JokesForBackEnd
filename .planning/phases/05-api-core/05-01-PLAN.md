---
phase: 05-api-core
plan: 01
type: execute
---

<objective>
Set up Django REST Framework foundation with base configuration and serializers.

Purpose: Establish the API infrastructure that all endpoints will build upon.
Output: DRF installed and configured, serializers for all models ready for viewset use.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/02-data-models/02-01-SUMMARY.md
@.planning/phases/04-search-engine/04-01-SUMMARY.md

# Key source files:
@jokes/models.py
@jokes/managers.py
@JokesForProject/settings.py
@requirements.txt

**Tech stack available:**
- Django 5.2.10
- PostgreSQL with full-text search
- django-pgtrigger for search vector updates

**Established patterns:**
- Lookup tables with name/slug/description pattern
- M2M for multi-value attributes, FK for single-value
- JokeManager.search() for full-text search with filters

**Constraining decisions:**
- Phase 02: PROTECT on_delete for required FKs, slugs on all lookup tables
- Phase 04: websearch query type, distinct() for M2M filter results
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install DRF and dependencies, configure base settings</name>
  <files>requirements.txt, JokesForProject/settings.py</files>
  <action>
Install Django REST Framework and related packages:
- djangorestframework (latest 3.15.x)
- drf-spectacular (for OpenAPI/Swagger docs)
- django-cors-headers (for frontend CORS)

Add to INSTALLED_APPS in order:
- 'rest_framework'
- 'drf_spectacular'
- 'corsheaders'

Add 'corsheaders.middleware.CorsMiddleware' to MIDDLEWARE - must be placed high, before CommonMiddleware.

Configure REST_FRAMEWORK settings:
- DEFAULT_PAGINATION_CLASS: 'rest_framework.pagination.PageNumberPagination'
- PAGE_SIZE: 20
- DEFAULT_THROTTLE_CLASSES: AnonRateThrottle, UserRateThrottle
- DEFAULT_THROTTLE_RATES: anon=100/hour, user=1000/hour
- DEFAULT_SCHEMA_CLASS: 'drf_spectacular.openapi.AutoSchema'
- DEFAULT_VERSIONING_CLASS: 'rest_framework.versioning.URLPathVersioning'
- DEFAULT_VERSION: 'v1'
- ALLOWED_VERSIONS: ['v1']

Configure SPECTACULAR_SETTINGS:
- TITLE: 'Jokes For API'
- DESCRIPTION: 'API for discovering and searching jokes'
- VERSION: '1.0.0'

Configure CORS (permissive for development):
- CORS_ALLOW_ALL_ORIGINS: True (dev only - will restrict in production)
  </action>
  <verify>python manage.py check returns no errors</verify>
  <done>DRF, drf-spectacular, and django-cors-headers installed and configured in settings.py</done>
</task>

<task type="auto">
  <name>Task 2: Create serializers for Joke and all lookup models</name>
  <files>jokes/serializers.py</files>
  <action>
Create jokes/serializers.py with serializers for all 8 models:

**Lookup serializers (simple):**
- FormatSerializer: id, name, slug, description
- AgeRatingSerializer: id, name, slug, description, min_age
- ToneSerializer: id, name, slug, description
- ContextTagSerializer: id, name, slug, description
- LanguageSerializer: id, code, name
- CultureTagSerializer: id, name, slug, description
- SourceSerializer: id, name, url, description

**JokeSerializer (nested):**
- id, text, setup, punchline
- format (nested FormatSerializer, read_only)
- age_rating (nested AgeRatingSerializer, read_only)
- language (nested LanguageSerializer, read_only)
- source (nested SourceSerializer, read_only, allow_null)
- tones (nested ToneSerializer, many=True, read_only)
- context_tags (nested ContextTagSerializer, many=True, read_only)
- culture_tags (nested CultureTagSerializer, many=True, read_only)
- created_at, updated_at

**JokeListSerializer (compact for list views):**
- id, text (truncated to 100 chars via SerializerMethodField)
- format (slug only via SlugRelatedField)
- age_rating (slug only via SlugRelatedField)
- tones (list of slugs via SlugRelatedField many=True)

Use read_only=True on all nested serializers since this is a read-only API for now.
Do NOT include search_vector field in any serializer (internal only).
  </action>
  <verify>python -c "from jokes.serializers import JokeSerializer, FormatSerializer; print('Serializers import OK')"</verify>
  <done>All 8 model serializers created with appropriate nesting for detail vs list views</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pip install -r requirements.txt` succeeds
- [ ] `python manage.py check` returns no errors
- [ ] All serializers import without errors
- [ ] JokeSerializer correctly nests all related models
</verification>

<success_criteria>

- DRF and dependencies installed
- REST_FRAMEWORK settings configured (pagination, throttling, versioning)
- SPECTACULAR_SETTINGS configured
- CORS middleware and settings configured
- All 8 model serializers created
- JokeSerializer nests related data appropriately
- JokeListSerializer provides compact representation
</success_criteria>

<output>
After completion, create `.planning/phases/05-api-core/05-01-SUMMARY.md`
</output>
